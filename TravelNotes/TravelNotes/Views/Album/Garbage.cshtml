@model TravelNotes.Models.GarbageViewModel;
<link href="https://stackpath.bootstrapcdn.com/bootstrap/5.1.3/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-icons/1.8.1/font/bootstrap-icons.min.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">



<style>
    #TopS {
        display: flex;
        align-items: center; /* 使所有项垂直居中 */
        z-index: 100;
    }

        #TopS > div {
            display: flex;
            align-items: center;
            z-index: 1000;
        }

    #GuidedTour > a {
        border-radius: 10px;
    }

        #GuidedTour > a:hover {
            background-color: whitesmoke;
            transform: scale(1.05);
        }

    #A {
        display: inline-block;
        margin-top: 10px;
        justify-content: center; /* 水平居中 */
        align-items: center; /* 垂直居中 */
        background-color: white;
        border: 5px solid gray;
        border-radius: 20px;
        width: 100%;
        height: auto;
        padding-top: 14px;
    }
    .image-container {
        display: inline-block;
        margin-left: 20px;
        position: relative;
    }

        .image-container .hover-button {
            position: absolute;
            border: none;
            top: 0; /* 定位到容器的左上角 */
            left: 0;
            width: 40px; /* 按钮宽度，根据需要调整 */
            height: 40px; /* 按钮高度，根据需要调整 */
            color: white; /* 按钮文字颜色为白色 */
            text-align: center;
            line-height: 30px; /* 使文字垂直居中 */
            opacity: 0; /* 初始化不可见 */
            transition: opacity 0.3s ease; /* 平滑过渡效果 */
            cursor: pointer;
            background-color: black;
            background-color: rgba(0,0,0,0.3);
        }

        .image-container .hover-button-2 {
            position: absolute;
            width: 50px;
            right: 0;
            bottom: 0;
            border: none;
            background-color: rgba(0,0,0,0.3);
            color: #fff;
            cursor: pointer;
            opacity: 0; /* 初始设置不可见 */
            transition: opacity 0.5s ease;
        }

        .image-container:hover .hover-button {
            opacity: 1; /* 滑鼠停在上方才顯示出來 */
        }

        .image-container:hover .hover-button-2 {
            opacity: 1; /* 滑鼠停在上方才顯示出來 */
        }

    #deleteButton {
        border: none;
        font-weight: bold;
        border-radius: 10px;
        font-size: 20px;
        background-color: #F3E4C6;
    }

        #deleteButton:hover {
        transform: scale(1.05);
        background-color: whitesmoke;
    }
    #RetuAndDele > form > button{
        border: none;
        width: 45px;
        border-radius: 10px;
        background-color: white;
    }

    #RetuAndDele > form > button:hover{
        transform: scale(1.05);
        background-color: whitesmoke;

    }

    #deleteAllAlbum {
        border: none;
        font-weight: bold;
        border-radius: 10px;
        font-size: 20px;
        background-color: white;
    }

        #deleteAllAlbum:hover {
            transform: scale(1.05);
            background-color: whitesmoke;
        }

    #deleteAllPhoto{
        border: none;
        font-weight: bold;
        border-radius: 10px;
        font-size: 20px;
        background-color: white;
    }

        #deleteAllPhoto:hover {
        transform: scale(1.05);
        background-color: whitesmoke;
    }
</style>
<div id="TopS">
    <div>
        <a class="nav-link text-dark" style="font-weight: bold;font-size:20px;" asp-area="" asp-controller="Home" asp-action="Index">TravelNotes</a>
    </div>
    <div id="GuidedTour" style="margin:10px;">
        <a class="nav-link text-dark" asp-area="" asp-controller="Album" asp-action="Photo" style="font-weight: bold;font-size:20px;">我的相片</a>
        <a class="nav-link text-dark" asp-area="" asp-controller="Album" asp-action="Album" style="font-weight: bold;font-size:20px;">我的相簿</a>
        <a class="nav-link text-dark" asp-area="" asp-controller="Album" asp-action="Garbage" style="background-color:whitesmoke;font-weight: bold;border-radius: 10px;font-size:20px;">我的垃圾桶</a>
        

    </div>
       <div style="margin-left:48%;">
            <button id="deleteButton" class="nav-link text-dark" style="font-weight: bold;font-size:20px;"><i class="bi bi-trash"></i> 全部清空</button>
       </div> 
    
</div>
    <div>
        <div id="SuccessMessage" class="alert alert-success" style="display:none;"></div>
        <div id="FalseMessage" class="alert alert-danger" style="display:none;"></div>
        @if (TempData["Message"] != null)
        {
            <div class="alert alert-warning" role="alert" id="messageAlert">
                @TempData["Message"]
            </div>
        }
    </div>
<div id="A">
    <div style="margin-left:20px;">
        <div style="display:inline-block;font-size:30px;"><i class="fa-solid fa-book"></i> 相簿</div>
        <div style="display:inline-block;margin-left:1000px;font-weight: bold;font-size:16px;"><button id="deleteAllAlbum">清空相簿</button></div>
        
        <hr />
        @if (Model.Albums != null && Model.Albums.Any())
        {
            @foreach (var album in Model.Albums!)
            {
                // 假设photo.UploadDate是DateOnly类型
                DateOnly uploadDate = (DateOnly)album.CreateTime;

                // 将DateOnly转换为DateTime，时间设置为当天的开始（即午夜0点）
                DateTime uploadDateTime = uploadDate.ToDateTime(new TimeOnly(0, 0));

                // 计算从上传日期到现在的天数差异
                TimeSpan difference = DateTime.Now - uploadDateTime;

                // 计算到达30天还剩多少天
                int daysLeft = 30 - difference.Days;

                // 确保天数差异为正数，如果超过30天，可以设置为0或者保持为负数，根据你的需求来调整
                daysLeft = Math.Max(daysLeft, 0);
                <div style="display:inline-block;margin-left:20px;">
                    <!-- 图片和段落的容器 -->
                    <div style="display:flex; justify-content:center; align-items:center; flex-direction:column;">
                        <img style="width:100px;" src="~/images/photo-album.png" alt="Folder Icon" />
                        <p style="margin:0;">@album.AlbumName</p>
                    </div>
                    <div>
                        <p style="text-align:center; color:@(daysLeft < 5 ? "red" : "black");">離刪除日期還有 @daysLeft 天</p>
                    </div>

                        <!-- 按钮容器 -->
                    <div id="RetuAndDele" style="display: flex; justify-content: space-between;">
                        <!-- 还原相册的表单 -->
                        <form method="post" action="/Album/RestoreAlbum" style="display: inline;">
                            <input type="hidden" name="albumId" value="@album.AlbumId" />
                            <!-- 使用<button>标签来包裹图标，通过JS提交表单 -->
                            <button type="button" onclick="submitForm(this)">
                                <i class="bi bi-arrow-counterclockwise"></i>
                            </button>
                        </form>

                        <!-- 删除相册的表单 -->
                        <form method="post" action="/Album/DeleteAlb" style="display: inline;">
                            <input type="hidden" name="albumId" value="@album.AlbumId" />
                            <!-- 使用<button>标签并添加点击事件 -->
                            <button type="button" onclick="confirmDeletion(this)">
                                <i class="bi bi-trash"></i> <!-- Bootstrap 图标 -->
                            </button>
                        </form>
                    </div>   
                </div>
            }
        }
        else
        {
            <h3>目前沒有任何相簿</h3>
        }
    </div>
    <hr />
    <div style="margin:20px;">
        <div style="display:inline-block;font-size:30px;"><i class="bi bi-images"></i> 相片</div>

           <div style="display:inline-block;margin-left:1000px;font-weight: bold;font-size:16px;"><button id="deleteAllPhoto">清空相片</button></div> 
        
        <hr />
        @if (Model.Photos != null && Model.Photos.Any())
            {
                @foreach (var photo in Model.Photos!)
                {
                // 假设photo.UploadDate是DateOnly类型
                DateOnly uploadDate = (DateOnly)photo.UploadDate;

                // 将DateOnly转换为DateTime，时间设置为当天的开始（即午夜0点）
                DateTime uploadDateTime = uploadDate.ToDateTime(new TimeOnly(0, 0));

                // 计算从上传日期到现在的天数差异
                TimeSpan difference = DateTime.Now - uploadDateTime;

                // 计算到达30天还剩多少天
                int daysLeft = 30 - difference.Days;

                // 确保天数差异为正数，如果超过30天，可以设置为0或者保持为负数，根据你的需求来调整
                daysLeft = Math.Max(daysLeft, 0);
                <div id="Pho" class="image-container" style="margin-bottom:10px; position: relative;">
                    <div class="image-wrapper" style="position: relative; display: inline-block;">
                        <img id="dynamicImage" src="@photo.PhotoPath" class="myImages" style="width: 150px;height:150px;" />
                        <button id="return-image-btn-@photo.PhotoId" class="hover-button-2" data-album-id="@photo.AlbumId" data-photo-id="@photo.PhotoId"><i class="bi bi-arrow-counterclockwise"></i></button>
                    </div>
                    <div>
                        <p style="text-align:center; color:@(daysLeft < 5 ? "red" : "black");">離刪除日期還有 @daysLeft 天</p>
                    </div>
                    <button id="change-image-btn-@photo.PhotoId" class="hover-button" data-album-id="@photo.AlbumId" data-photo-id="@photo.PhotoId "><i class="bi bi-trash"></i></button>
                </div>

            }
        }else
        {
            <h3>目前沒有任何相片</h3>
        }
    </div>

</div>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    function submitForm(button) {
        // 找到按钮所在的表单并提交
        var form = button.closest('form');
        form.submit();
    }
    function confirmDeletion(button) {
        // 弹出确认对话框
        var confirmed = confirm('确定要删除这个相簿吗?');
        if (confirmed) {
            // 如果用户点击"确定", 提交所在的表单
            var form = button.closest('form');
            form.submit();
        }
    }

        $(document).ready(function () {
            var successMessage = localStorage.getItem('deleteSuccessMessage');
            var falseMessage = localStorage.getItem('deleteFalseMessage');

            if (successMessage) {
                $('#SuccessMessage').text(successMessage).show();
                localStorage.removeItem('deleteSuccessMessage');
            }
            if (falseMessage) {
                $('#FalseMessage').text(falseMessage).show();
                localStorage.removeItem('deleteFalseMessage');
            }
        });
        //清空垃圾桶
        $("#deleteButton").click(function () {
            var result = confirm("確定要清空垃圾桶嗎？");
            if (result) {
                $.ajax({
                    url: '/Album/DeleteByAlbumAndUserId',
                    type: 'POST',
                    success: function () {

                        localStorage.setItem('deleteSuccessMessage', '清空垃圾桶成功');
                        location.reload();
                    },
                    error: function () {

                        location.reload();
                    }
                });
            } else {
                // 如果用户点击“取消”，result 为 false
                alert("刪除已取消。");
            }
        });
        //清空所有相簿
        $("#deleteAllAlbum").click(function () {
            var result = confirm("確定要清空相簿嗎？");
            if (result) {
                $.ajax({
                    url: '/Album/DeleteAllAlbum',
                    type: 'POST',
                    success: function () {

                        localStorage.setItem('deleteSuccessMessage', '清空相簿成功');
                        location.reload();
                    },
                    error: function () {

                        localStorage.setItem('deleteFalseMessage', '清空相簿失敗');
                        location.reload();
                    }
                });
            } else {
                // 如果用户点击“取消”，result 为 false
                alert("刪除已取消。");
            }
        });
        //清空所有相片
        $("#deleteAllPhoto").click(function () {
            var result = confirm("確定要清空相片嗎？");
            if (result) {
                $.ajax({
                    url: '/Album/DeleteAllPhoto',
                    type: 'POST',
                    success: function () {

                        localStorage.setItem('deleteSuccessMessage', '清空相片成功');
                        location.reload();
                    },
                    error: function () {

                        localStorage.setItem('deleteFalseMessage', '清空相片失敗');
                        location.reload();
                    }
                });
            } else {
                // 如果用户点击“取消”，result 为 false
                alert("刪除已取消。");
            }
        });

        //刪除所選相片

        $(document).ready(function () {
            // 监听所有删除按钮的点击事件
            $('button[id^="change-image-btn"]').click(function () {
                var result = confirm("確定要刪除嗎？");
                var GarbagePhotoId = $(this).data('photo-id');
                // 发送Ajax请求到服务器
                if (result) {
                    $.ajax({
                        url: '/Album/GarbageDelete', // 控制器的Action路径
                        type: 'POST',
                        data: {
                            photoId: GarbagePhotoId,
                        },
                        success: function (response) {
                            // 处理成功的响应
                            localStorage.setItem('deleteSuccessMessage', '刪除成功');
                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            // 处理错误的响应
                            localStorage.setItem('deleteFalseMessage', '刪除失敗');
                            location.reload();
                        }
                    });
                } else {
                    // 如果用户点击“取消”，result 为 false
                    alert("刪除已取消。");
                }
            });
        });
        $(document).ready(function () {
            // 還原按钮的点击事件
            $('button[id^="return-image-btn"]').click(function () {
                var result = confirm("確定要還原嗎？");
                var albumId = $(this).data('album-id');
                var ReturnPhotoId = $(this).data('photo-id');
                // 发送Ajax请求到服务器
                if (result) {
                    $.ajax({
                        url: '/Album/ReturnAlbumId', // 控制器的Action路径
                        type: 'POST',
                        data: {
                            photoId: ReturnPhotoId,
                            NowAlbum: albumId,
                        },
                        success: function (response) {
                            // 处理成功的响应
                            localStorage.setItem('deleteSuccessMessage', '還原相片成功');
                            location.reload();
                        },
                        error: function (xhr, status, error) {
                            // 处理错误的响应
                            localStorage.setItem('deleteFalseMessage', '還原相片失敗');
                            location.reload();
                        }
                    });
                } else {
                    // 如果用户点击“取消”，result 为 false
                    alert("還原取消。");
                }
            });
        });
        setTimeout(function () {
            $('#SuccessMessage').fadeOut('slow');
        }, 3000);


        setTimeout(function () {
            $('#FalseMessage').fadeOut('slow');
        }, 3000);
        $(document).ready(function () {
            // SET一個定時器
            setTimeout(function () {
                //使用 jQuery 的 fadeOut 方法淡出
                $("#messageAlert").fadeOut("slow");
            }, 3000); // 3 秒
        });

    </script>

